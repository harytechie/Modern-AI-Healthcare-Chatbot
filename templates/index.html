<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0d9488">
    <title>HealthCare Chatbot</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <!-- Pure CSS sidebar toggle (no JS) -->
    <input type="checkbox" id="sidebarToggle" aria-hidden="true">

    <div class="app-wrapper">
        <!-- Backdrop overlay — tapping closes the sidebar -->
        <label for="sidebarToggle" class="sidebar-backdrop" aria-hidden="true"></label>

        <div class="sidebar">
            <!-- Close button (mobile only) -->
            <label for="sidebarToggle" class="sidebar-close" aria-label="Close sidebar">✕</label>
            <h2>HealthCare Chatbot</h2>
            <div class="sidebar-content">
                <p>Welcome to our AI-powered healthcare assistant. Feel free to ask any health-related questions or
                    describe your symptoms.</p>
            </div>
            <div class="health-tips">
                <h3>Quick Health Tips</h3>
                <ul>
                    <li>Stay hydrated</li>
                    <li>Get enough sleep</li>
                    <li>Exercise regularly</li>
                    <li>Eat a balanced diet</li>
                </ul>
            </div>
        </div>
        <div class="chat-container">
            <div class="chat-header">
                <label for="sidebarToggle" class="hamburger-btn" aria-label="Toggle sidebar">☰</label>
                <!-- AI Doctor Logo -->
                <span class="header-icon">
                    <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                        <!-- Doctor head silhouette -->
                        <circle cx="20" cy="13" r="7" fill="rgba(255,255,255,0.9)" />
                        <!-- Doctor body/shoulders -->
                        <path d="M8 34 C8 25, 14 21, 20 21 C26 21, 32 25, 32 34" fill="rgba(255,255,255,0.9)" />
                        <!-- Stethoscope -->
                        <path d="M14 24 C14 28, 12 30, 12 32" stroke="rgba(255,255,255,0.6)" stroke-width="1.5"
                            fill="none" stroke-linecap="round" />
                        <circle cx="12" cy="33" r="1.5" fill="rgba(255,255,255,0.6)" />
                        <!-- AI circuit lines on head -->
                        <line x1="17" y1="10" x2="15" y2="8" stroke="#0ea5e9" stroke-width="1" stroke-linecap="round" />
                        <line x1="23" y1="10" x2="25" y2="8" stroke="#0ea5e9" stroke-width="1" stroke-linecap="round" />
                        <line x1="20" y1="9" x2="20" y2="6" stroke="#0ea5e9" stroke-width="1" stroke-linecap="round" />
                        <!-- AI circuit nodes -->
                        <circle cx="15" cy="8" r="1.2" fill="#0ea5e9" />
                        <circle cx="25" cy="8" r="1.2" fill="#0ea5e9" />
                        <circle cx="20" cy="6" r="1.2" fill="#0ea5e9" />
                        <!-- Neural connection arcs -->
                        <path d="M15 8 Q20 4, 25 8" stroke="#0ea5e9" stroke-width="0.8" fill="none"
                            stroke-linecap="round" />
                        <!-- Medical cross on body -->
                        <rect x="18.5" y="25" width="3" height="7" rx="0.5" fill="#0ea5e9" opacity="0.8" />
                        <rect x="16.5" y="27" width="7" height="3" rx="0.5" fill="#0ea5e9" opacity="0.8" />
                        <!-- Pulse line -->
                        <polyline points="5,20 10,20 12,16 14,24 16,18 18,20 35,20" stroke="rgba(255,255,255,0.25)"
                            stroke-width="1" fill="none" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </span>
                <span class="header-title">Chat with HealthCare Bot</span>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    Hello! I'm your healthcare assistant. How can I help you today?
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="userInput" placeholder="Type your message here..."
                    aria-label="Type your message">
                <button id="sendButton" aria-label="Send message">Send</button>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            let sessionId = Date.now().toString();

            function addMessage(message, isUser) {
                const messageDiv = $('<div>').addClass('message').text(message);
                if (isUser) {
                    messageDiv.addClass('user-message');
                } else {
                    messageDiv.addClass('bot-message');
                }
                $('#chatMessages').append(messageDiv);
                $('#chatMessages').scrollTop($('#chatMessages')[0].scrollHeight);
            }

            function sendMessage(message) {
                $.ajax({
                    url: '/chatbot',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ message: message, session_id: sessionId }),
                    success: function (response) {
                        addMessage(response.response, false);

                        if (response.response.includes("Are you currently at Ganpat University campus?")) {
                            addMessage("If yes, would you like to book an appointment at the Guni Health Clinic? (Yes/No)", false);
                        }
                    },
                    error: function (xhr, status, error) {
                        addMessage("Error: " + error, false);
                    }
                });
            }

            function bookAppointment(time) {
                $.ajax({
                    url: '/book_appointment',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        session_id: sessionId,
                        preferred_time: time
                    }),
                    success: function (response) {
                        addMessage(response.response, false);
                        if (response.response.includes("Would you like to book this slot?")) {
                            addMessage("Please respond with 'Yes' to confirm the suggested slot, or provide another time.", false);
                        }
                    },
                    error: function (xhr, status, error) {
                        addMessage("Error booking appointment: " + error, false);
                    }
                });
            }

            // Initial message
            addMessage("Hello! I'm your healthcare assistant. What should I call you?", false);

            $('#sendButton').click(function () {
                const userInput = $('#userInput').val().trim();
                if (userInput === '') return;

                addMessage(userInput, true);
                $('#userInput').val('');

                if (userInput.toLowerCase() === 'yes' && $('#chatMessages').text().includes("would you like to book an appointment")) {
                    addMessage("Great! Please provide a preferred time for your appointment (HH:MM):", false);
                } else if (userInput.match(/^\d{2}:\d{2}$/)) {
                    bookAppointment(userInput);
                } else {
                    sendMessage(userInput);
                }
            });

            $('#userInput').keypress(function (e) {
                if (e.which == 13) {
                    $('#sendButton').click();
                }
            });
        });
    </script>
</body>

</html>